(()=>{async function t(t,e){const n=await fetch(t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8","X-CSRF-TOKEN":token},credentials:"same-origin",body:JSON.stringify(e)});if(!n.ok){const t=await n.text().catch(()=>"");throw new Error("HTTP "+n.status+" – "+t)}return(n.headers.get("Content-Type")||"").includes("application/json")?n.json():{html:await n.text()}}function e(t,e){t.setProgressState?.(!1),e&&e.setEnabled(!0)}async function n(t,n,o){try{!function(t,e){e&&e.setEnabled(!1),t.setProgressState?.(!0)}(t,n),await o(),e(t,n),t.notificationManager.open({text:"Terminé",type:"success",timeout:1800})}catch(o){console.error("[tinymce-process] error:",o),e(t,n),t.notificationManager.open({text:"Échec du traitement",type:"error",timeout:2500})}}function o(t){return t.selection?.getContent({format:"html"})||""}window.tinymce&&(tinymce.PluginManager.add("text_expand",function(e){let i=null;e.addCommand("textExpandRun",async function(){const a=o(e);if(!a.trim())return void e.notificationManager.open({text:"Sélectionnez du texte à traiter.",type:"warning",timeout:2e3});const r=e.selection.getBookmark(2,!0);await n(e,i,async()=>{const n=await t("@@process-textexpand",{html:a});if(!n||"string"!=typeof n.html)throw new Error("Réponse invalide");e.undoManager.transact(()=>{e.selection.moveToBookmark(r),e.selection.setContent(n.html)})})}),e.ui.registry.addButton("text_expand",{text:"Text expand",tooltip:"Process text expand",onAction:()=>e.execCommand("textExpandRun"),onSetup:t=>(i=t,()=>i=null)})}),tinymce.PluginManager.add("suggest_titles",function(e){let i=null;e.addCommand("suggestTitlesRun",async function(){const a=o(e);if(!a.trim())return void e.notificationManager.open({text:"Sélectionnez le passage pour proposer des titres.",type:"warning",timeout:2e3});const r=e.selection.getBookmark(2,!0);await n(e,i,async()=>{const n=await t("@@process-suggesttitles",{html:a});if(!n||"string"!=typeof n.html)throw new Error("Réponse invalide");e.undoManager.transact(()=>{e.selection.moveToBookmark(r),e.selection.setContent(n.html)})})}),e.ui.registry.addButton("suggest_titles",{text:"Suggest titles",tooltip:"Proposer des titres",onAction:()=>e.execCommand("suggestTitlesRun"),onSetup:t=>(i=t,()=>i=null)})}),tinymce.PluginManager.add("text_improve",function(e){let i=null;e.addCommand("textImproveRun",async function(){const a=o(e);if(!a.trim())return void e.notificationManager.open({text:"Sélectionnez le passage pour améliorer le texte.",type:"warning",timeout:2e3});const r=e.selection.getBookmark(2,!0);await n(e,i,async()=>{const n=await t("@@process-textimprove",{html:a});if(!n||"string"!=typeof n.html)throw new Error("Réponse invalide");e.undoManager.transact(()=>{e.selection.moveToBookmark(r),e.selection.setContent(n.html)})})}),e.ui.registry.addButton("text_improve",{text:"Text improve",tooltip:"Améliorer le texte",onAction:()=>e.execCommand("textImproveRun"),onSetup:t=>(i=t,()=>i=null)})}),tinymce.PluginManager.add("text_shorter",function(e){let i=null;e.addCommand("textShorterRun",async function(){const a=o(e);if(!a.trim())return void e.notificationManager.open({text:"Sélectionnez le passage pour raccourcir le texte.",type:"warning",timeout:2e3});const r=e.selection.getBookmark(2,!0);await n(e,i,async()=>{const n=await t("@@process-textshorter",{html:a});if(!n||"string"!=typeof n.html)throw new Error("Réponse invalide");e.undoManager.transact(()=>{e.selection.moveToBookmark(r),e.selection.setContent(n.html)})})}),e.ui.registry.addButton("text_shorter",{text:"Text shorter",tooltip:"Raccourcir le texte",onAction:()=>e.execCommand("textShorterRun"),onSetup:t=>(i=t,()=>i=null)})}),tinymce.PluginManager.add("ia",function(t){t.ui.registry.addMenuButton("ia",{text:"IA",tooltip:"Outils IA",fetch:e=>{e([{type:"menuitem",text:"Text expand",onAction:()=>t.execCommand("textExpandRun")},{type:"menuitem",text:"Suggest titles",onAction:()=>t.execCommand("suggestTitlesRun")},{type:"menuitem",text:"Text improve",onAction:()=>t.execCommand("textImproveRun")},{type:"menuitem",text:"Text shorter",onAction:()=>t.execCommand("textShorterRun")}])}})}),tinymce.PluginManager.add("ia_menuitems",function(t){t.ui.registry.addMenuItem("ia_text_expand",{text:"Text expand",onAction:()=>t.execCommand("textExpandRun")}),t.ui.registry.addMenuItem("ia_suggest_titles",{text:"Suggest titles",onAction:()=>t.execCommand("suggestTitlesRun")})}))})();